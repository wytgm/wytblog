const cheerio=require("cheerio"),moment=require("moment");function postsChart(n){const t=moment(n||"2020-01"),e=moment(),a=new Map;for(let n=t;n<=e;n+=864e5){const t=moment(n).format("YYYY-MM");a.has(t)||a.set(t,0)}hexo.locals.get("posts").forEach((function(n){const t=n.date.format("YYYY-MM");a.has(t)&&a.set(t,a.get(t)+1)}));return`\n  <script id="postsChart">\n    var color = document.documentElement.getAttribute('data-theme') === 'light' ? '#4c4948' : 'rgba(255,255,255,0.7)'\n    var postsChart = echarts.init(document.getElementById('posts-chart'), 'light');\n    var postsOption = {\n      title: {\n        text: '文章发布统计图',\n        x: 'center',\n        textStyle: {\n          color: color\n        }\n      },\n      tooltip: {\n        trigger: 'axis'\n      },\n      xAxis: {\n        name: '日期',\n        type: 'category',\n        boundaryGap: false,\n        nameTextStyle: {\n          color: color\n        },\n        axisTick: {\n          show: false\n        },\n        axisLabel: {\n          show: true,\n          color: color\n        },\n        axisLine: {\n          show: true,\n          lineStyle: {\n            color: color\n          }\n        },\n        data: ${JSON.stringify([...a.keys()])}\n      },\n      yAxis: {\n        name: '文章篇数',\n        type: 'value',\n        nameTextStyle: {\n          color: color\n        },\n        splitLine: {\n          show: false\n        },\n        axisTick: {\n          show: false\n        },\n        axisLabel: {\n          show: true,\n          color: color\n        },\n        axisLine: {\n          show: true,\n          lineStyle: {\n            color: color\n          }\n        }\n      },\n      series: [{\n        name: '文章篇数',\n        type: 'line',\n        smooth: true,\n        lineStyle: {\n            width: 0\n        },\n        showSymbol: false,\n        itemStyle: {\n          opacity: 1,\n          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{\n            offset: 0,\n            color: 'rgba(128, 255, 165)'\n          },\n          {\n            offset: 1,\n            color: 'rgba(1, 191, 236)'\n          }])\n        },\n        areaStyle: {\n          opacity: 1,\n          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{\n            offset: 0,\n            color: 'rgba(128, 255, 165)'\n          }, {\n            offset: 1,\n            color: 'rgba(1, 191, 236)'\n          }])\n        },\n        data: ${JSON.stringify([...a.values()])},\n        markLine: {\n          data: [{\n            name: '平均值',\n            type: 'average',\n            label: {\n              color: color\n            }\n          }]\n        }\n      }]\n    };\n    postsChart.setOption(postsOption);\n    window.addEventListener('resize', () => { \n      postsChart.resize();\n    });\n    postsChart.on('click', 'series', (event) => {\n      if (event.componentType === 'series') window.location.href = '/archives/' + event.name.replace('-', '/');\n    });\n  <\/script>`}function tagsChart(n){const t=[];hexo.locals.get("tags").map((function(n){t.push({name:n.name,value:n.length,path:n.path})})),t.sort(((n,t)=>t.value-n.value));const e=Math.min(t.length,n)||t.length,a=[];for(let n=0;n<e;n++)a.push(t[n].name);return`\n  <script id="tagsChart">\n    var color = document.documentElement.getAttribute('data-theme') === 'light' ? '#4c4948' : 'rgba(255,255,255,0.7)'\n    var tagsChart = echarts.init(document.getElementById('tags-chart'), 'light');\n    var tagsOption = {\n      title: {\n        text: 'Top ${e} 标签统计图',\n        x: 'center',\n        textStyle: {\n          color: color\n        }\n      },\n      tooltip: {},\n      xAxis: {\n        name: '标签',\n        type: 'category',\n        nameTextStyle: {\n          color: color\n        },\n        axisTick: {\n          show: false\n        },\n        axisLabel: {\n          show: true,\n          color: color,\n          interval: 0\n        },\n        axisLine: {\n          show: true,\n          lineStyle: {\n            color: color\n          }\n        },\n        data: ${JSON.stringify(a)}\n      },\n      yAxis: {\n        name: '文章篇数',\n        type: 'value',\n        splitLine: {\n          show: false\n        },\n        nameTextStyle: {\n          color: color\n        },\n        axisTick: {\n          show: false\n        },\n        axisLabel: {\n          show: true,\n          color: color\n        },\n        axisLine: {\n          show: true,\n          lineStyle: {\n            color: color\n          }\n        }\n      },\n      series: [{\n        name: '文章篇数',\n        type: 'bar',\n        data: ${JSON.stringify(t)},\n        itemStyle: {\n          borderRadius: [5, 5, 0, 0],\n          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{\n            offset: 0,\n            color: 'rgba(128, 255, 165)'\n          },\n          {\n            offset: 1,\n            color: 'rgba(1, 191, 236)'\n          }])\n        },\n        emphasis: {\n          itemStyle: {\n            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{\n              offset: 0,\n              color: 'rgba(128, 255, 195)'\n            },\n            {\n              offset: 1,\n              color: 'rgba(1, 211, 255)'\n            }])\n          }\n        },\n        markLine: {\n          data: [{\n            name: '平均值',\n            type: 'average',\n            label: {\n              color: color\n            }\n          }]\n        }\n      }]\n    };\n    tagsChart.setOption(tagsOption);\n    window.addEventListener('resize', () => { \n      tagsChart.resize();\n    });\n    tagsChart.on('click', 'series', (event) => {\n      if(event.data.path) window.location.href = '/' + event.data.path;\n    });\n  <\/script>`}function categoriesChart(n){const t=[];let e=!1;hexo.locals.get("categories").map((function(n){n.parent&&(e=!0),t.push({name:n.name,value:n.length,path:n.path,id:n._id,parentId:n.parent||"0"})})),e=e&&"true"===n,t.sort(((n,t)=>t.value-n.value));const a=JSON.stringify(t.map((function(n){return n.name}))),r=JSON.stringify(t),o=JSON.stringify(function n(t,e){let a,r=[];return t.forEach(((o,s)=>{if(t[s].parentId==e){let e=t[s];a=n(t,t[s].id),a.length>0&&(e.children=a),r.indexOf()&&r.push(e)}})),r}(t,"0"));return`\n  <script id="categoriesChart">\n    var color = document.documentElement.getAttribute('data-theme') === 'light' ? '#4c4948' : 'rgba(255,255,255,0.7)'\n    var categoriesChart = echarts.init(document.getElementById('categories-chart'), 'light');\n    var categoryParentFlag = ${e}\n    var categoriesOption = {\n      title: {\n        text: '文章分类统计图',\n        x: 'center',\n        textStyle: {\n          color: color\n        }\n      },\n      legend: {\n        top: 'bottom',\n        data: ${a},\n        textStyle: {\n          color: color\n        }\n      },\n      tooltip: {\n        trigger: 'item'\n      },\n      series: []\n    };\n    categoriesOption.series.push(\n      categoryParentFlag ? \n      {\n        nodeClick :false,\n        name: '文章篇数',\n        type: 'sunburst',\n        radius: ['15%', '90%'],\n        center: ['50%', '55%'],\n        sort: 'desc',\n        data: ${o},\n        itemStyle: {\n          borderColor: '#fff',\n          borderWidth: 2,\n          emphasis: {\n            focus: 'ancestor',\n            shadowBlur: 10,\n            shadowOffsetX: 0,\n            shadowColor: 'rgba(255, 255, 255, 0.5)'\n          }\n        }\n      }\n      :\n      {\n        name: '文章篇数',\n        type: 'pie',\n        radius: [30, 80],\n        roseType: 'area',\n        label: {\n          color: color,\n          formatter: '{b} : {c} ({d}%)'\n        },\n        data: ${r},\n        itemStyle: {\n          emphasis: {\n            shadowBlur: 10,\n            shadowOffsetX: 0,\n            shadowColor: 'rgba(255, 255, 255, 0.5)'\n          }\n        }\n      }\n    )\n    categoriesChart.setOption(categoriesOption);\n    window.addEventListener('resize', () => { \n      categoriesChart.resize();\n    });\n    categoriesChart.on('click', 'series', (event) => {\n      if(event.data.path) window.location.href = '/' + event.data.path;\n    });\n  <\/script>`}hexo.extend.filter.register("after_render:html",(function(n){const t=cheerio.load(n),e=t("#posts-chart"),a=t("#tags-chart"),r=t("#categories-chart"),o=!1;return e.length>0||a.length>0||r.length>0?(e.length>0&&0===t("#postsChart").length&&("true"===e.attr("data-encode")&&(o=!0),e.after(postsChart(e.attr("data-start")))),a.length>0&&0===t("#tagsChart").length&&("true"===a.attr("data-encode")&&(o=!0),a.after(tagsChart(a.attr("data-length")))),r.length>0&&0===t("#categoriesChart").length&&("true"===r.attr("data-encode")&&(o=!0),r.after(categoriesChart(r.attr("data-parent")))),o?t.root().html().replace(/&amp;#/g,"&#"):t.root().html()):n}),15);